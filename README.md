# üóÇÔ∏è Directory json scanner

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è **–±—ã—Å—Ç—Ä–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π** —Å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤ –≤ JSON.
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—É—é –∑–∞–ø–∏—Å—å (`--stream`), –∫–æ–Ω—Ç—Ä–æ–ª—å I/O (`--io-limit`), –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ MD5,
–∞ —Ç–∞–∫–∂–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö JSON-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (`--merge`, `--merge-flat`, `--merge-children`).

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**

* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–æ–º –≤–æ—Ä–∫–µ—Ä–æ–≤ (`--workers`)
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π (`--io-limit`)

‚úÖ **MD5 –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ**

* –†–µ–∞–ª—å–Ω—ã–π `md5` –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∏ –ø—Å–µ–≤–¥–æ-MD5 –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
* –†–∞–∑–º–µ—Ä—ã, –¥–∞—Ç—ã, –ø—Ä–∞–≤–∞, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ (`image`, `video`, `code`, ‚Ä¶)

‚úÖ **–ü–æ—Ç–æ–∫–æ–≤–∞—è –∑–∞–ø–∏—Å—å (`--stream`)**

* –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–ø–∏—Å—å –±–æ–ª—å—à–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ temp JSON
* –ê–≤—Ç–æ—Ñ–ª–∞—à –∫–∞–∂–¥—ã–µ 500 —ç–ª–µ–º–µ–Ω—Ç–æ–≤

‚úÖ **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**

* –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ `Ctrl+C` (SIGINT/SIGTERM)
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–µ–º–∞—Ñ–æ—Ä–æ–≤

‚úÖ **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ JSON-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**

* `--merge` ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤
* `--merge-flat` ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–ª–æ—Å–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (`[]FileInfo`)
* `--merge-children` ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ **–¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ä–Ω–µ–π** —Å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–º —Å–ª–∏—è–Ω–∏–µ–º –ø–æ –∏–º–µ–Ω–∞–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
* –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (`--dedupe`)

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
go build -o build main.go
```

–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ:

```bash
go install ./...
```

---

## üì¶ –§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –ü—Ä–∏–º–µ—Ä –¥–µ—Ä–µ–≤–∞ (–∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π JSON)

```json
{
  "IsDir": true,
  "FullName": "project",
  "FullPath": "/home/user/project",
  "ChildCount": 3,
  "Children": [
    {
      "IsDir": true,
      "FullName": "src",
      "ChildCount": 2,
      "Children": [
        {"IsDir": false, "FullName": "main.go", "SizeBytes": 1234},
        {"IsDir": false, "FullName": "utils.go", "SizeBytes": 987}
      ]
    },
    {
      "IsDir": false,
      "FullName": "README.md",
      "SizeBytes": 456
    }
  ]
}
```

### –ü—Ä–∏–º–µ—Ä flat-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (`--merge-flat`)

```json
[
  {"FullPath": "/home/user/project", "IsDir": true},
  {"FullPath": "/home/user/project/src", "IsDir": true},
  {"FullPath": "/home/user/project/src/main.go", "IsDir": false}
]
```

---

## üß≠ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–ª–∞–≥–∏

| –§–ª–∞–≥               | –û–ø–∏—Å–∞–Ω–∏–µ                                           |
| ------------------ | -------------------------------------------------- |
| `--dir`            | –ü—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è                   |
| `--output`         | –ò–º—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ JSON-—Ñ–∞–π–ª–∞                           |
| `--pretty`         | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å JSON —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏                     |
| `--stream`         | –ü–æ—Ç–æ–∫–æ–≤–∞—è –∑–∞–ø–∏—Å—å (–¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)          |
| `--workers`        | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω                    |
| `--io-limit`       | –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π                |
| `--no-md5`         | –ù–µ –≤—ã—á–∏—Å–ª—è—Ç—å MD5 –¥–ª—è —Ñ–∞–π–ª–æ–≤                        |
| `--exclude`        | –ò—Å–∫–ª—é—á–∏—Ç—å –ø—É—Ç–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞) |
| `--merge`          | –°–ø–∏—Å–æ–∫ JSON-—Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è                 |
| `--merge-flat`     | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∫–∞–∫ flat-–º–∞—Å—Å–∏–≤    |
| `--merge-children` | –û–±—ä–µ–¥–∏–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ä–Ω–µ–π         |
| `--dedupe`         | –£–¥–∞–ª—è—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ merge –ø–æ `FullPathOrig`      |

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üîç –û–±—ã—á–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
./build --dir=/home/resager/projects --output=projects.json --pretty
```

### ‚ö° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –ø–æ—Ç–æ–∫–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
./build --dir=/media/resager/4tbWdPortable --output=4tb.json --stream --workers=8 --io-limit=8
```

–í—ã–≤–æ–¥:

```
üìÅ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ—Ç–æ–∫–æ–º: /media/resager/4tbWdPortable
‚öôÔ∏è  Workers: 8 | I/O limit: 8 | MD5: true
üìä 20000 —Ñ–∞–π–ª–æ–≤ | 36.2s | 552 —Ñ/—Å | 110 MB RAM
‚úÖ –ü–æ—Ç–æ–∫–æ–≤—ã–π temp –∑–∞–ø–∏—Å–∞–Ω: 4tb_temp.json
üéâ –ì–æ—Ç–æ–≤–æ. –§–∞–π–ª–æ–≤: 1 825 302 | 11m28s
```

### üß© –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
./build --merge 1.json,2.json --output merged.json
```

### üå≤ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤

```bash
./build --merge 1.json,2.json --merge-children --output merged.json --pretty
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:

```
üß© –†–µ–∂–∏–º: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ—Ä–Ω–µ–π (--merge-children)
‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –∫–æ—Ä–µ–Ω—å: Photos_2024+Photos_2025 | merged.json
```

---

## üß† –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö `FileInfo`

| –ü–æ–ª–µ                  | –¢–∏–ø          | –û–ø–∏—Å–∞–Ω–∏–µ           |
| --------------------- | ------------ | ------------------ |
| `IsDir`               | `bool`       | –ü–∞–ø–∫–∞ –∏–ª–∏ —Ñ–∞–π–ª     |
| `FullName`            | `string`     | –ò–º—è —Ñ–∞–π–ª–∞/–ø–∞–ø–∫–∏    |
| `FullPath`            | `string`     | –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å    |
| `ParentDir`           | `string`     | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å  |
| `SizeBytes`           | `int64`      | –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö    |
| `SizeHuman`           | `string`     | –ß–∏—Ç–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä    |
| `Created` / `Updated` | `time.Time`  | –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏    |
| `Perm`                | `string`     | –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞      |
| `Md5`                 | `string`     | MD5 —Ö—ç—à            |
| `ChildCount`          | `int`        | –ö–æ–ª-–≤–æ –ø–æ—Ç–æ–º–∫–æ–≤    |
| `Children`            | `[]FileInfo` | –í–ª–æ–∂–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã |

---

## üß© –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ Ctrl+C

–ü—Ä–æ—Ü–µ—Å—Å –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:

```
^C
‚èπ SIGINT ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
üìÅ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è I/O...
‚úÖ –ü–æ—Ç–æ–∫–æ–≤—ã–π temp –∑–∞–ø–∏—Å–∞–Ω: /media/resager/..._temp.json
üéâ –ì–æ—Ç–æ–≤–æ (—á–∞—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
```

–§–∞–π–ª –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è.

---

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

* –î–ª—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤ MD5 —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ).
* –ü–æ—Ç–æ–∫–æ–≤—ã–π —Ä–µ–∂–∏–º (`--stream`) —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π `_temp.json`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–∂–µ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è –≤ –∏—Ç–æ–≥–æ–≤—ã–π.
* –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (`--resume`) –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –≤ TODO).

---

## üîß TODO / Roadmap

* [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `--resume` –¥–ª—è –¥–æ–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è
* [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É, –¥–∞—Ç–µ, —Ç–∏–ø—É —Ñ–∞–π–ª–∞
* [ ] –í—ã–≤–æ–¥ –≤ SQLite –∏–ª–∏ CSV
* [ ] REST API / Web UI –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ JSON
* [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö merges (>1 GB)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è (deep merge, dedupe –∏ children merge) –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã —Ç–µ—Å—Ç—ã:

```bash
go test -v
```

–ü—Ä–∏–º–µ—Ä—ã:

* `TestMergeChildrenBasic`
* `TestMergeChildren_DuplicateFilesAndDirs`

---

## üßæ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ¬© 2025 Resager
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —É–∫–∞–∑–∞–Ω–∏—è –∞–≤—Ç–æ—Ä–∞.
